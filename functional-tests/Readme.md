# BDDStack

## Description

This is an example of incorporating Geb into a Gradle build. It shows the use of Spock and JUnit 4 tests.

The build is setup to work with a variety of browsers and we aim to add as many as possible.
A JenkinsSlave image has been created that can run Chrome/Firefox Headless tests. This offers a viable option for replacing phantomJs in the OpenShift pipeline. Please see the [JenkinsSlave Dockerfile][dockerfile] setup.
This repository also holds a Dockerfile for a CentOS based image that will run headless tests as well.

BDDStack is 100% compatible with the tests that were created in the previous incarnation of the framework called [NavUnit][navunit] (which is now deprecated). Please see the wiki for instructions on how to use your NavUnit Tests in BDDStack.

Please see the [Wiki](https://github.com/BCDevOps/BDDStack/wiki) for more details.

## Usage

The following commands will launch the tests with the individual browsers:

    ./gradlew chromeTest
    ./gradlew chromeHeadlessTest //Will run in pipeline as well
    ./gradlew firefoxTest
    ./gradlew firefoxHeadlessTest //Will run in pipeline as well
    ./gradlew edgeTest
    ./gradlew ieTest //Read wiki for set up instructions
    ./gradlew safariTest //Only for MacOS, read wiki for instructions.
    
To run with all, you can run:

    ./gradlew test

Replace `./gradlew` with `gradlew.bat` in the above examples if you're on Windows.

## Getting Started

Within this section the reader will gain insight on how to get started with this framework.

### Conventions
The HTML User Interface has design has adopted the following conventions to make any clickable element discoverable, and any page assertable:
 
1) all elements that you would like "clickable" (images, links, buttons, column headers, etc) must have the HTML "id" attribute specified.

*example:*

`<a id="link_home" href="#">Home</a>`

2) All pages will contain a unique HTML title (do not share a title across pages)

*example:*

`<title>Unique Title Here</title>`

### Define Pages

As mentioned above this framework leverages the Page Object Model Pattern to reduce the brittleness of functional testing, and increase the expressiveness of functional testing

Each page you would like to be able Assertions on need to be defined as follows:
```
class QSystemInfoPage extends Page {
    static url = "/qsystem/info" 
    static at = { title=="" }	
}
```

Where the ***'url'*** is the relative path to the Base Url of the application

Where the ***'at'*** is the way to uniquely identify the page from all other pages in the application ***see conventions section above***


## Build Pipeline

The functional tests are executed via a stage in the build pipeline.  The stage will result in a pass or fail depending on the result of the test. 

## Generated Reports

Additional detail on a test may be obtained by reviewing the reports generated by a test.  These can be viewed by running the test locally and then opening the contents of following directory (relative to the project base folder)

- `functional-tests/build/reports/<name of driver>Test/tests/index.html`

Where `<name of driver>` is either chrome or phantomJs.

## Questions and issues

Please refer to BCDevOps [BDDStack](https://github.com/BCDevOps/bddstack) repository for questions and issues.

## Useful Links:

<http://www.gebish.org/manual/current>

<http://spockframework.org/>

<http://groovy-lang.org/>

<https://inviqa.com/blog/bdd-guide>

<https://github.com/SeleniumHQ/selenium/wiki>


[navunit]: https://github.com/bcgov/navUnit
[dockerfile]: https://github.com/BCDevOps/openshift-tools/blob/master/provisioning/jenkins-slaves/bddstack/Dockerfile
[issue_tracker]: https://github.com/rstens/BDDStack/issues
[slack_channel]: https://devopspathfinder.slack.com/messages/C7J72K1MG
